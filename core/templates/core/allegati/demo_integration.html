<!-- 
DEMO INTEGRATION - Esempio di integrazione sistema allegati
============================================================

Template dimostrativo che mostra come integrare il sistema allegati
in una pagina detail view di qualsiasi oggetto del sistema.

Questo è un template di esempio per gli sviluppatori.

Usage:
    Copiare le sezioni necessarie nelle pagine detail dei vostri modelli.
-->

{% extends 'base.html' %}
{% load static %}
{% load allegati_tags %}

{% block title %}{{ object }} - Dettaglio con Allegati{% endblock %}

{% block extra_css %}
<!-- CSS per allegati già incluso nei widget -->
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        
        <!-- Colonna Principale - Contenuto Oggetto -->
        <div class="col-lg-9">
            <!-- Header Oggetto -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2>{{ object }}</h2>
                    <p class="text-muted mb-0">Dettaglio {{ object|get_class_name }}</p>
                </div>
                <div>
                    {% allegati_badge object %}
                </div>
            </div>

            <!-- Informazioni Principali Oggetto -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Informazioni Principali</h5>
                </div>
                <div class="card-body">
                    <!-- Qui vanno i dati specifici del tuo oggetto -->
                    <p><strong>ID:</strong> {{ object.id }}</p>
                    <p><strong>Creato il:</strong> {{ object.creato_il|date:"d/m/Y H:i"|default:"N/A" }}</p>
                    <!-- Aggiungi altri campi specifici del modello -->
                </div>
            </div>

            <!-- SEZIONE ALLEGATI COMPLETA -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-folder-open me-2"></i>
                        Documenti e Allegati
                    </h5>
                </div>
                <div class="card-body">
                    {% allegati_section object show_stats=True show_filters=True show_search=True %}
                </div>
            </div>

        </div>

        <!-- Sidebar -->
        <div class="col-lg-3">
            
            <!-- WIDGET ALLEGATI COMPATTO -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">Allegati Recenti</h6>
                </div>
                <div class="card-body">
                    {% allegati_widget object widget_type="sidebar" limit=5 %}
                </div>
            </div>

            <!-- Statistiche Allegati -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">Statistiche Allegati</h6>
                </div>
                <div class="card-body">
                    {% allegati_stats object as stats %}
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h4 mb-0 text-primary">{{ stats.totale|default:0 }}</div>
                            <small class="text-muted">Totale</small>
                        </div>
                        <div class="col-6">
                            <div class="h4 mb-0 text-success">{% allegati_count object "doc_" %}</div>
                            <small class="text-muted">Documenti</small>
                        </div>
                    </div>
                    <hr>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h5 mb-0 text-info">{% allegati_count object "foto_" %}</div>
                            <small class="text-muted">Foto</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 mb-0 text-warning">{% allegati_count object "nota_" %}</div>
                            <small class="text-muted">Note</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista Allegati per Tipo -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">Documenti Ufficiali</h6>
                </div>
                <div class="card-body">
                    {% allegati_list object types="doc_" limit=3 %}
                </div>
            </div>

            <!-- Azioni Rapide -->
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">Azioni Rapide</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary btn-sm allegato-add-btn"
                                data-bs-toggle="modal" data-bs-target="#allegatoModal"
                                data-action="create" data-object-id="{{ object.id }}" 
                                data-content-type-id="{% content_type_id object %}">
                            <i class="fas fa-plus me-1"></i>
                            Aggiungi Documento
                        </button>
                        
                        <button type="button" class="btn btn-success btn-sm allegato-add-btn"
                                data-bs-toggle="modal" data-bs-target="#allegatoModal"
                                data-action="create" data-object-id="{{ object.id }}" 
                                data-content-type-id="{% content_type_id object %}"
                                data-preset-type="foto_generale">
                            <i class="fas fa-camera me-1"></i>
                            Aggiungi Foto
                        </button>
                        
                        <button type="button" class="btn btn-info btn-sm allegato-add-btn"
                                data-bs-toggle="modal" data-bs-target="#allegatoModal"
                                data-action="create" data-object-id="{{ object.id }}" 
                                data-content-type-id="{% content_type_id object %}"
                                data-preset-type="nota_interna">
                            <i class="fas fa-sticky-note me-1"></i>
                            Aggiungi Nota
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include Modal Allegato -->
{% include 'core/allegati/modals/allegato_modal.html' %}

<!-- Include Scripts Allegati -->
{% allegati_scripts object %}

<!-- ============================================================ -->
<!-- SEZIONI ALTERNATIVE PER DIVERSE ESIGENZE DI LAYOUT         -->
<!-- ============================================================ -->

<!-- Versione TAB per allegati -->
<!--
<ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dettagli" type="button">
            Dettagli
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#allegati" type="button">
            Allegati {% allegati_badge object style="secondary" %}
        </button>
    </li>
</ul>

<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="dettagli" role="tabpanel">
        <!-- Contenuto dettagli oggetto -->
    </div>
    <div class="tab-pane fade" id="allegati" role="tabpanel">
        {% allegati_section object show_grid=False show_stats=True %}
    </div>
</div>
-->

<!-- Versione ACCORDION per allegati -->
<!--
<div class="accordion" id="accordionExample">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                Informazioni Principali
            </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show">
            <div class="accordion-body">
                <!-- Contenuto dettagli oggetto -->
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                Allegati e Documenti {% allegati_badge object style="primary" %}
            </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse">
            <div class="accordion-body">
                {% allegati_section object show_stats=True %}
            </div>
        </div>
    </div>
</div>
-->

<!-- Versione MODAL FULL-SCREEN per gestione allegati -->
<!--
<div class="modal fade" id="allegatiFullModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Gestione Allegati - {{ object }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                {% allegati_section object show_grid=True columns=4 show_stats=True show_filters=True %}
            </div>
        </div>
    </div>
</div>
-->

{% endblock %}

{% block extra_js %}
<script>
// Esempio di personalizzazione JavaScript per allegati
document.addEventListener('DOMContentLoaded', function() {
    
    // Gestione preset tipo allegato dai pulsanti azioni rapide
    document.addEventListener('click', function(e) {
        if (e.target.closest('[data-preset-type]')) {
            const btn = e.target.closest('[data-preset-type]');
            const presetType = btn.dataset.presetType;
            
            // Quando si apre il modal, preseleziona il tipo
            setTimeout(() => {
                const tipoSelect = document.getElementById('id_tipo_allegato');
                if (tipoSelect && presetType) {
                    tipoSelect.value = presetType;
                    
                    // Attiva tab appropriato
                    if (presetType.startsWith('nota_')) {
                        const textTab = document.getElementById('text-tab');
                        if (textTab) textTab.click();
                    }
                }
            }, 100);
        }
    });
    
    // Auto-refresh del widget quando un allegato viene aggiunto/modificato
    window.addEventListener('allegatoSaved', function(e) {
        console.log('Allegato salvato, refresh widget...');
        if (window.refreshAllegatiWidget) {
            window.refreshAllegatiWidget();
        }
    });
});
</script>
{% endblock %}