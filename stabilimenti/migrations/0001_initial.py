# Generated by Django 4.2.21 on 2025-12-10 03:00

from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("anagrafica", "0003_alter_fornitore_partita_iva"),
    ]

    operations = [
        migrations.CreateModel(
            name="Stabilimento",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "nome",
                    models.CharField(
                        help_text="Nome identificativo dello stabilimento",
                        max_length=200,
                    ),
                ),
                (
                    "codice_stabilimento",
                    models.CharField(
                        help_text="Codice univoco per identificazione rapida",
                        max_length=10,
                        unique=True,
                    ),
                ),
                ("indirizzo", models.CharField(max_length=300)),
                (
                    "cap",
                    models.CharField(
                        max_length=5,
                        validators=[
                            django.core.validators.RegexValidator(
                                message="Il CAP deve essere di 5 cifre",
                                regex="^\\d{5}$",
                            )
                        ],
                    ),
                ),
                ("citta", models.CharField(max_length=100)),
                (
                    "provincia",
                    models.CharField(
                        max_length=2,
                        validators=[
                            django.core.validators.RegexValidator(
                                message="Provincia deve essere di 2 lettere maiuscole",
                                regex="^[A-Z]{2}$",
                            )
                        ],
                    ),
                ),
                (
                    "telefono",
                    models.CharField(
                        blank=True,
                        help_text="Telefono principale dello stabilimento",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "email_filiale",
                    models.EmailField(
                        blank=True,
                        help_text="Email principale dello stabilimento",
                        max_length=254,
                        null=True,
                    ),
                ),
                (
                    "superficie_mq",
                    models.PositiveIntegerField(
                        blank=True, help_text="Superficie in metri quadrati", null=True
                    ),
                ),
                (
                    "numero_piani",
                    models.PositiveSmallIntegerField(
                        default=1, help_text="Numero di piani dell'edificio"
                    ),
                ),
                (
                    "anno_costruzione",
                    models.PositiveSmallIntegerField(
                        blank=True,
                        help_text="Anno di costruzione dell'edificio",
                        null=True,
                    ),
                ),
                (
                    "attivo",
                    models.BooleanField(
                        default=True, help_text="Indica se lo stabilimento è attivo"
                    ),
                ),
                (
                    "data_apertura",
                    models.DateField(
                        blank=True,
                        help_text="Data di apertura/attivazione dello stabilimento",
                        null=True,
                    ),
                ),
                (
                    "data_chiusura",
                    models.DateField(
                        blank=True,
                        help_text="Data di chiusura (se applicabile)",
                        null=True,
                    ),
                ),
                (
                    "note_generali",
                    models.TextField(
                        blank=True,
                        help_text="Note generali sullo stabilimento",
                        null=True,
                    ),
                ),
                ("data_creazione", models.DateTimeField(auto_now_add=True)),
                ("data_modifica", models.DateTimeField(auto_now=True)),
                (
                    "creato_da",
                    models.ForeignKey(
                        help_text="Utente che ha creato lo stabilimento (automatico)",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="stabilimenti_creati",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "modificato_da",
                    models.ForeignKey(
                        blank=True,
                        help_text="Ultimo utente che ha modificato lo stabilimento",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="stabilimenti_modificati",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "responsabile_amministrativo",
                    models.ForeignKey(
                        blank=True,
                        help_text="Responsabile amministrativo dello stabilimento (scelto manualmente)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="stabilimenti_amministrativi",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "responsabile_operativo",
                    models.ForeignKey(
                        blank=True,
                        help_text="Responsabile operativo dello stabilimento (scelto manualmente)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="stabilimenti_operativi",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Stabilimento",
                "verbose_name_plural": "Stabilimenti",
                "ordering": ["nome"],
            },
        ),
        migrations.CreateModel(
            name="DocStabilimento",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "nome_documento",
                    models.CharField(
                        help_text="Nome identificativo del documento", max_length=200
                    ),
                ),
                (
                    "tipo_documento",
                    models.CharField(
                        choices=[
                            (
                                "scia",
                                "SCIA (Segnalazione Certificata di Inizio Attività)",
                            ),
                            ("dia", "DIA (Dichiarazione di Inizio Attività)"),
                            ("autorizzazione", "Autorizzazione Edilizia"),
                            ("permesso_costruire", "Permesso di Costruire"),
                            ("contratto_derattizzazione", "Contratto Derattizzazione"),
                            ("contratto_disinfestazione", "Contratto Disinfestazione"),
                            ("contratto_pulizie", "Contratto Pulizie"),
                            ("contratto_vigilanza", "Contratto Vigilanza"),
                            ("contratto_manutenzione", "Contratto Manutenzione"),
                            (
                                "cert_prevenzione_incendi",
                                "Certificato Prevenzione Incendi",
                            ),
                            ("cert_agibilita", "Certificato di Agibilità"),
                            ("cert_conformita", "Certificato di Conformità"),
                            ("collaudo_impianti", "Collaudo Impianti"),
                            ("verifica_ascensori", "Verifica Ascensori"),
                            ("controllo_caldaie", "Controllo Caldaie"),
                            ("controllo_antincendio", "Controllo Sistemi Antincendio"),
                            ("aut_emissioni", "Autorizzazione Emissioni"),
                            ("gestione_rifiuti", "Autorizzazione Gestione Rifiuti"),
                            ("planimetria", "Planimetria"),
                            ("denuncia", "Denuncia/Comunicazione"),
                            ("rapporto", "Rapporto Tecnico"),
                            ("verbale", "Verbale Controllo"),
                            ("contratto", "Contratto Generico"),
                            ("certificazione", "Certificazione Generica"),
                            ("altro", "Altro"),
                        ],
                        default="altro",
                        help_text="Tipologia del documento",
                        max_length=30,
                    ),
                ),
                (
                    "versione",
                    models.CharField(
                        default="1.0", help_text="Versione del documento", max_length=10
                    ),
                ),
                (
                    "descrizione",
                    models.TextField(
                        blank=True,
                        help_text="Descrizione del contenuto del documento",
                        null=True,
                    ),
                ),
                (
                    "file_documento",
                    models.FileField(
                        help_text="File del documento",
                        upload_to="documenti_stabilimenti/%Y/%m/",
                    ),
                ),
                (
                    "data_documento",
                    models.DateField(
                        blank=True,
                        help_text="Data del documento (se diversa dalla data di caricamento)",
                        null=True,
                    ),
                ),
                (
                    "data_scadenza",
                    models.DateField(
                        blank=True,
                        help_text="Data di scadenza del documento (se applicabile)",
                        null=True,
                    ),
                ),
                (
                    "attivo",
                    models.BooleanField(
                        default=True,
                        help_text="Indica se il documento è ancora valido/attivo",
                    ),
                ),
                (
                    "note",
                    models.TextField(
                        blank=True, help_text="Note aggiuntive sul documento", null=True
                    ),
                ),
                ("data_inserimento", models.DateTimeField(auto_now_add=True)),
                ("data_modifica", models.DateTimeField(auto_now=True)),
                (
                    "caricato_da",
                    models.ForeignKey(
                        help_text="Utente che ha caricato il documento",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="documenti_caricati",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "stabilimento",
                    models.ForeignKey(
                        help_text="Stabilimento di riferimento",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="documenti",
                        to="stabilimenti.stabilimento",
                    ),
                ),
            ],
            options={
                "verbose_name": "Documento Stabilimento",
                "verbose_name_plural": "Documenti Stabilimenti",
                "ordering": ["-data_inserimento"],
            },
        ),
        migrations.CreateModel(
            name="CostiStabilimento",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "numero_pratica",
                    models.CharField(
                        help_text="Numero pratica generato automaticamente",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "causale",
                    models.CharField(
                        choices=[
                            ("manutenzione_ordinaria", "Manutenzione Ordinaria"),
                            (
                                "manutenzione_straordinaria",
                                "Manutenzione Straordinaria",
                            ),
                            ("adeguamento", "Adeguamento Strutturale"),
                            ("servizi_periodici", "Servizi Periodici"),
                            ("certificazioni", "Certificazioni Obbligatorie"),
                            ("energia_elettrica", "Energia Elettrica"),
                            ("gas_naturale", "Gas Naturale"),
                            ("acqua", "Acqua e Scarichi"),
                            ("telefonia", "Telefonia e Internet"),
                            ("rifiuti", "Smaltimento Rifiuti"),
                            ("sicurezza", "Sicurezza e Vigilanza"),
                            ("pulizie", "Servizi di Pulizia"),
                            ("assicurazioni", "Assicurazioni"),
                            ("tasse", "Tasse e Tributi"),
                            ("altro", "Altro"),
                        ],
                        default="servizi_periodici",
                        max_length=50,
                        verbose_name="Tipologia Costo",
                    ),
                ),
                (
                    "stato",
                    models.CharField(
                        choices=[
                            ("preventivo", "Preventivo"),
                            ("approvato", "Approvato"),
                            ("in_corso", "In Corso"),
                            ("completato", "Completato"),
                            ("fatturato", "Fatturato"),
                            ("pagato", "Pagato"),
                        ],
                        default="preventivo",
                        max_length=20,
                        verbose_name="Stato della Pratica",
                    ),
                ),
                (
                    "titolo",
                    models.CharField(
                        help_text="Titolo/oggetto dell'intervento o servizio",
                        max_length=200,
                    ),
                ),
                (
                    "descrizione",
                    models.TextField(
                        help_text="Descrizione dettagliata dell'intervento"
                    ),
                ),
                (
                    "importo",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Importo del costo",
                        max_digits=10,
                        validators=[
                            django.core.validators.MinValueValidator(Decimal("0.01"))
                        ],
                    ),
                ),
                (
                    "iva_percentuale",
                    models.DecimalField(
                        decimal_places=2,
                        default=22,
                        max_digits=5,
                        validators=[
                            django.core.validators.MinValueValidator(Decimal("0"))
                        ],
                        verbose_name="IVA %",
                    ),
                ),
                (
                    "data_richiesta",
                    models.DateField(
                        default=django.utils.timezone.now,
                        help_text="Data della richiesta/preventivo",
                    ),
                ),
                (
                    "data_inizio_lavori",
                    models.DateField(
                        blank=True,
                        help_text="Data inizio intervento/servizio",
                        null=True,
                    ),
                ),
                (
                    "data_fine_lavori",
                    models.DateField(
                        blank=True, help_text="Data fine intervento/servizio", null=True
                    ),
                ),
                (
                    "data_fattura",
                    models.DateField(
                        blank=True, help_text="Data della fattura", null=True
                    ),
                ),
                (
                    "data_scadenza_servizio",
                    models.DateField(
                        blank=True,
                        help_text="Data del prossimo intervento programmato o scadenza certificazione",
                        null=True,
                        verbose_name="Prossima Scadenza",
                    ),
                ),
                (
                    "fattura",
                    models.FileField(
                        blank=True,
                        help_text="File della fattura",
                        null=True,
                        upload_to="fatture_stabilimenti/%Y/%m/",
                    ),
                ),
                (
                    "preventivo",
                    models.FileField(
                        blank=True,
                        help_text="File del preventivo",
                        null=True,
                        upload_to="preventivi_stabilimenti/%Y/%m/",
                    ),
                ),
                (
                    "certificato",
                    models.FileField(
                        blank=True,
                        help_text="Certificato o documento ufficiale",
                        null=True,
                        upload_to="certificati_stabilimenti/%Y/%m/",
                    ),
                ),
                (
                    "allegato1",
                    models.FileField(
                        blank=True,
                        null=True,
                        upload_to="allegati_stabilimenti/%Y/%m/",
                        verbose_name="Allegato 1",
                    ),
                ),
                (
                    "allegato2",
                    models.FileField(
                        blank=True,
                        null=True,
                        upload_to="allegati_stabilimenti/%Y/%m/",
                        verbose_name="Allegato 2",
                    ),
                ),
                (
                    "allegato3",
                    models.FileField(
                        blank=True,
                        null=True,
                        upload_to="allegati_stabilimenti/%Y/%m/",
                        verbose_name="Allegato 3",
                    ),
                ),
                (
                    "note_interne",
                    models.TextField(
                        blank=True,
                        help_text="Note interne non visibili nei documenti",
                        null=True,
                    ),
                ),
                ("data_creazione", models.DateTimeField(auto_now_add=True)),
                ("data_modifica", models.DateTimeField(auto_now=True)),
                (
                    "consumo_kwh",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                (
                    "consumo_mc",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                ("periodo_fatturazione_da", models.DateField(blank=True, null=True)),
                ("periodo_fatturazione_a", models.DateField(blank=True, null=True)),
                (
                    "codice_pdr_pod",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                (
                    "fornitore",
                    models.ForeignKey(
                        help_text="Fornitore del servizio/lavoro",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="costi_stabilimenti",
                        to="anagrafica.fornitore",
                    ),
                ),
                (
                    "incaricato",
                    models.ForeignKey(
                        help_text="Responsabile interno della pratica",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="costi_gestiti",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "stabilimento",
                    models.ForeignKey(
                        help_text="Stabilimento di riferimento",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="costi",
                        to="stabilimenti.stabilimento",
                    ),
                ),
            ],
            options={
                "verbose_name": "Costo Stabilimento",
                "verbose_name_plural": "Costi Stabilimenti",
                "ordering": ["-data_creazione"],
            },
        ),
        migrations.AddIndex(
            model_name="stabilimento",
            index=models.Index(fields=["attivo"], name="stabiliment_attivo_5a5210_idx"),
        ),
        migrations.AddIndex(
            model_name="stabilimento",
            index=models.Index(
                fields=["codice_stabilimento"], name="stabiliment_codice__3450ae_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="stabilimento",
            index=models.Index(
                fields=["responsabile_operativo"], name="stabiliment_respons_a21798_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="stabilimento",
            index=models.Index(
                fields=["responsabile_amministrativo"],
                name="stabiliment_respons_239e66_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="stabilimento",
            index=models.Index(fields=["citta"], name="stabiliment_citta_acf5f6_idx"),
        ),
        migrations.AddIndex(
            model_name="docstabilimento",
            index=models.Index(
                fields=["stabilimento", "tipo_documento"],
                name="stabiliment_stabili_044e11_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="docstabilimento",
            index=models.Index(
                fields=["data_scadenza"], name="stabiliment_data_sc_71f4e1_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="docstabilimento",
            index=models.Index(fields=["attivo"], name="stabiliment_attivo_4e0026_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="docstabilimento",
            unique_together={("stabilimento", "nome_documento", "versione")},
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(
                fields=["stabilimento", "causale"],
                name="stabiliment_stabili_4d2eee_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(
                fields=["data_scadenza_servizio"], name="stabiliment_data_sc_1016e6_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(fields=["stato"], name="stabiliment_stato_18852b_idx"),
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(
                fields=["fornitore"], name="stabiliment_fornito_462b07_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(
                fields=["data_fattura"], name="stabiliment_data_fa_6685ce_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="costistabilimento",
            index=models.Index(
                fields=["numero_pratica"], name="stabiliment_numero__613300_idx"
            ),
        ),
    ]
